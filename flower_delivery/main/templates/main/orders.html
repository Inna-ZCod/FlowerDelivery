{% extends 'base.html' %}

{% block title %}Мои заказы{% endblock %}


{% block content %}
<h2>Мои заказы</h2>

{% for order in orders %}
    <div class="order-item">
        <p><strong>Заказ №{{ order.order_id }}</strong></p>
        <p><strong>Статус:</strong> {{ order.status }}</p>
        <p><strong>Дата создания:</strong> {{ order.created_at }}</p>
        <p><strong>Букет:</strong> {{ order.bouquet_name }}</p>
        <p><strong>Адрес доставки:</strong> {{ order.delivery_address }}</p>

        {% for label, value in order.card_info %}
            <p><strong>{{ label }}</strong> {{ value }}</p>
        {% endfor %}

        <p><strong>Цена:</strong> {{ order.price }} руб.</p>

        <a href="{% url 'repeat_order' order.order_id %}" class="btn btn-primary">Повторить заказ</a>

        {% if order.status == "Доставлен" %}
            {% if not order.has_review %}
                <a href="{% url 'leave_review' order.order_id %}" class="btn btn-primary">Оставить отзыв</a>
            {% else %}
                <p class="text-success"><strong>Отзыв уже оставлен</strong></p>
            {% endif %}
        {% endif %}


    </div>
    <hr>
{% endfor %}


<!-- Кнопка подключения телеграм-бота -->
    {% if not user.telegram_chat_id %}
    <div class="alert alert-info">
        Вы ещё не подключили Telegram для уведомлений.
        <a class="btn btn-primary" href="https://t.me/FlowerDeliveryHelperBot?start={{ user.id }}" target="_blank" rel="noopener noreferrer">
            Подключить Telegram
        </a>
    </div>
    {% endif %}
{% endblock %}